<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok on Pi Network</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #status {
            margin-top: 10px;
            color: red;
        }
    </style>
</head>
<body>
    <h1>TikTok on Pi Network</h1>
    <div id="auth-status">Authenticating...</div>
    <div id="status"></div>

    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <script>
        // API Key Configuration
        const PI_API_KEY = 'ecz510ma0qx2jo0dham6mazyzmxn4x4tfzcd6g7b6kx56xdiarbaotdaq3e7tg4m';

        // Update status message
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        // Initialize Pi SDK
        (function initializePiSDK() {
            try {
                Pi.init({
                    version: "2.0",
                    sandbox: true, // Set to false in production
                    apiKey: PI_API_KEY
                });

                // Configure authentication
                Pi.configure({
                    authentication: {
                        redirectUri: window.location.href,
                        onReady: () => {
                            console.log("Pi Auth Ready");
                            updateStatus("Auth system ready");
                        },
                        onError: (error) => {
                            console.error("Pi Auth Error:", error);
                            updateStatus("Auth error: " + error.message);
                        }
                    }
                });

                updateStatus("Pi SDK initialized. Starting authentication...");
            } catch (e) {
                updateStatus("Pi SDK init failed: " + e.message);
                console.error("Initialization error:", e);
                return;
            }
        })();

        // Handle authentication
        async function authenticate() {
            try {
                const auth = await Pi.authenticate(['username', 'payments'], onIncompletePayment);
                document.getElementById('auth-status').innerHTML = 
                    `Welcome <strong>${auth.user.username}</strong>!`;
                updateStatus("Authentication successful!");
                // Add your post-auth logic here
                // Example: Fetch user data or initiate payments
            } catch (error) {
                updateStatus("Auth failed: " + error.message);
                console.error("Authentication error:", error);
            }
        }

        // Handle incomplete payments
        async function onIncompletePayment(payment) {
            console.log("Found incomplete payment:", payment);
            try {
                await Pi.submitPayment(payment.identifier);
                updateStatus("Payment completed successfully");
                return true;
            } catch (error) {
                updateStatus("Payment error: " + error.message);
                console.error("Payment error:", error);
                return false;
            }
        }

        // Start authentication when ready
        if (typeof Pi !== 'undefined') {
            Pi.on('ready', authenticate);
        } else {
            console.error('Pi SDK not loaded');
            updateStatus('Error: Pi SDK failed to load');
        }
    </script>
</body>
</html>