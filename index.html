<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok on Pi Network</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #status {
            margin-top: 10px;
            color: red;
        }
    </style>
</head>
<body>
    <h1>TikTok on Pi Network</h1>
    <div id="auth-status">Authenticating...</div>
    <div id="status"></div>

    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <script>
        // API Key Configuration
        const PI_API_KEY = 'ecz510ma0qx2jo0dham6mazyzmxn4x4tfzcd6g7b6kx56xdiarbaotdaq3e7tg4m';

        // Update status message
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        // Wait for Pi SDK to load
        window.addEventListener('load', function() {
            if (typeof Pi === 'undefined') {
                updateStatus('Error: Pi SDK failed to load');
                console.error('Pi SDK not loaded');
                return;
            }

            // Initialize Pi SDK
            try {
                Pi.init({
                    version: "2.0",
                    sandbox: true, // Set to false in production
                    apiKey: PI_API_KEY
                });
                updateStatus("Pi SDK initialized. Starting authentication...");
                
                // Start authentication immediately after init
                authenticate();
            } catch (e) {
                updateStatus("Pi SDK init failed: " + e.message);
                console.error("Initialization error:", e);
            }
        });

        // Handle authentication
        async function authenticate() {
            try {
                const auth = await Pi.authenticate(['username', 'payments'], onIncompletePayment);
                document.getElementById('auth-status').innerHTML = 
                    `Welcome <strong>${auth.user.username}</strong>!`;
                updateStatus("Authentication successful!");
                // Add your post-auth logic here
            } catch (error) {
                updateStatus("Auth failed: " + error.message);
                console.error("Authentication error:", error);
            }
        }

        // Handle incomplete payments
        async function onIncompletePayment(payment) {
            console.log("Found incomplete payment:", payment);
            try {
                await Pi.submitPayment(payment.identifier);
                updateStatus("Payment completed successfully");
                return true;
            } catch (error) {
                updateStatus("Payment error: " + error.message);
                console.error("Payment error:", error);
                return false;
            }
        }
    </script>
</body>
</html>